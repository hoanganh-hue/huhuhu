#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Demo Output System - Chá»©ng minh há»‡ thá»‘ng output tá»± Ä‘á»™ng hoáº¡t Ä‘á»™ng
"""

import sys
import os
from pathlib import Path
from datetime import datetime

# ThÃªm src vÃ o Python path
project_root = Path(__file__).parent
sys.path.insert(0, str(project_root / "src"))

from src.utils.output_manager import get_output_manager, save_report, save_data, copy_to_output

def demo_output_system():
    """Demo há»‡ thá»‘ng output"""
    print("ğŸ¯ DEMO OUTPUT SYSTEM - BHXH Data Tools")
    print("=" * 60)
    
    # Khá»Ÿi táº¡o OutputManager
    om = get_output_manager(project_root)
    print(f"ğŸ“ Output Directory: {om.output_root}")
    print()
    
    # Demo 1: LÆ°u bÃ¡o cÃ¡o
    print("ğŸ“Š Demo 1: LÆ°u bÃ¡o cÃ¡o tá»± Ä‘á»™ng")
    report_content = f"""# Demo Report - Output System

## ThÃ´ng Tin Demo
- **Thá»i gian táº¡o:** {datetime.now().strftime("%Y-%m-%d %H:%M:%S")}
- **Dá»± Ã¡n:** BHXH Data Tools v2.0.0
- **Tráº¡ng thÃ¡i:** âœ… Hoáº¡t Ä‘á»™ng hoÃ n háº£o

## TÃ­nh NÄƒng ÄÃ£ Test
- âœ… Tá»± Ä‘á»™ng táº¡o timestamp
- âœ… Tá»± Ä‘á»™ng tá»• chá»©c thÆ° má»¥c
- âœ… Tá»± Ä‘á»™ng phÃ¢n loáº¡i file
- âœ… Tá»± Ä‘á»™ng táº¡o bÃ¡o cÃ¡o vá»›i format chuáº©n

## Káº¿t Quáº£
Há»‡ thá»‘ng output Ä‘Ã£ Ä‘Æ°á»£c cÃ i Ä‘áº·t thÃ nh cÃ´ng vÃ  hoáº¡t Ä‘á»™ng Ä‘Ãºng nhÆ° mong Ä‘á»£i.

## Cáº¥u TrÃºc Output
```
output/
â”œâ”€â”€ reports/     # BÃ¡o cÃ¡o (.md, .txt, .html, .pdf)
â”œâ”€â”€ data/        # Dá»¯ liá»‡u (.xlsx, .csv, .json, .xml)
â”œâ”€â”€ logs/        # Log files (.log, .out, .err)
â”œâ”€â”€ exports/     # File export (.zip, .tar, .gz)
â”œâ”€â”€ backups/     # Backup files (.bak, .backup, .old)
â””â”€â”€ temp/        # File táº¡m thá»i
```

---
*Generated by Output System Demo*
"""
    
    report_path = save_report(report_content, "Demo Report")
    print(f"âœ… BÃ¡o cÃ¡o Ä‘Ã£ Ä‘Æ°á»£c lÆ°u: {report_path}")
    print()
    
    # Demo 2: LÆ°u dá»¯ liá»‡u
    print("ğŸ“Š Demo 2: LÆ°u dá»¯ liá»‡u tá»± Ä‘á»™ng")
    demo_data = {
        "project": "BHXH Data Tools",
        "version": "2.0.0",
        "demo_timestamp": datetime.now().isoformat(),
        "output_system": {
            "status": "working",
            "features": [
                "auto_timestamp",
                "auto_organization", 
                "auto_file_type_detection",
                "auto_directory_creation",
                "auto_cleanup"
            ],
            "directories": {
                "reports": "BÃ¡o cÃ¡o vÃ  tÃ i liá»‡u",
                "data": "Dá»¯ liá»‡u Excel, CSV, JSON",
                "logs": "Log files vÃ  output",
                "exports": "File export vÃ  archive",
                "backups": "Backup files",
                "temp": "File táº¡m thá»i"
            }
        },
        "test_results": {
            "report_generation": "âœ… Success",
            "data_saving": "âœ… Success", 
            "file_organization": "âœ… Success",
            "timestamp_generation": "âœ… Success"
        }
    }
    
    data_path = save_data(demo_data, "demo_output_system_data.json")
    print(f"âœ… Dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c lÆ°u: {data_path}")
    print()
    
    # Demo 3: Copy file hiá»‡n táº¡i vÃ o output
    print("ğŸ“Š Demo 3: Copy file vÃ o output directory")
    current_file = Path(__file__)
    backup_path = copy_to_output(current_file, "demo_script_backup.py", "backups")
    print(f"âœ… File Ä‘Ã£ Ä‘Æ°á»£c backup: {backup_path}")
    print()
    
    # Demo 4: Hiá»ƒn thá»‹ tÃ³m táº¯t
    print("ğŸ“Š Demo 4: TÃ³m táº¯t output directory")
    summary = om.get_output_summary()
    print(f"ğŸ“ Tá»•ng sá»‘ files: {summary['total_files']}")
    print(f"ğŸ“Š Tá»•ng dung lÆ°á»£ng: {summary['total_size']:,} bytes")
    print()
    
    print("ğŸ“‚ Chi tiáº¿t theo thÆ° má»¥c:")
    for dir_name, info in summary['directories'].items():
        if info['file_count'] > 0:
            print(f"  ğŸ“ {dir_name}: {info['file_count']} files, {info['total_size']:,} bytes")
    print()
    
    print("ğŸ“„ Files gáº§n nháº¥t:")
    for file_info in summary['recent_files'][:5]:
        print(f"  ğŸ“„ {file_info['path']} ({file_info['size']} bytes)")
    print()
    
    # Demo 5: Táº¡o log file
    print("ğŸ“Š Demo 5: Táº¡o log file tá»± Ä‘á»™ng")
    log_content = f"""DEMO OUTPUT SYSTEM LOG
====================

Timestamp: {datetime.now().isoformat()}
Project: BHXH Data Tools v2.0.0
Status: Demo completed successfully

Actions Performed:
1. âœ… Generated demo report
2. âœ… Saved demo data as JSON
3. âœ… Created backup of demo script
4. âœ… Generated output summary
5. âœ… Created this log file

Output Directory: {om.output_root}
Total Files Created: {summary['total_files']}
Total Size: {summary['total_size']} bytes

Demo completed successfully!
"""
    
    log_path = om.save_log(log_content, "demo_execution")
    print(f"âœ… Log file Ä‘Ã£ Ä‘Æ°á»£c táº¡o: {log_path}")
    print()
    
    # Káº¿t luáº­n
    print("ğŸ‰ DEMO HOÃ€N THÃ€NH!")
    print("=" * 60)
    print("âœ… Há»‡ thá»‘ng output tá»± Ä‘á»™ng hoáº¡t Ä‘á»™ng hoÃ n háº£o!")
    print("âœ… Táº¥t cáº£ file káº¿t quáº£ Ä‘Ã£ Ä‘Æ°á»£c lÆ°u vÃ o output/ directory")
    print("âœ… Cáº¥u trÃºc thÆ° má»¥c Ä‘Æ°á»£c tá»• chá»©c khoa há»c")
    print("âœ… Timestamp tá»± Ä‘á»™ng Ä‘Æ°á»£c thÃªm vÃ o tÃªn file")
    print("âœ… File Ä‘Æ°á»£c phÃ¢n loáº¡i tá»± Ä‘á»™ng theo extension")
    print()
    print("ğŸš€ Äá»ƒ sá»­ dá»¥ng trong thá»±c táº¿:")
    print("   python3 run_with_output.py <script_name>")
    print()
    print(f"ğŸ“ Xem káº¿t quáº£ táº¡i: {om.output_root}")

if __name__ == "__main__":
    demo_output_system()